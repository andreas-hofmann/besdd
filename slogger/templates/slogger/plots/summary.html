{% extends 'base.html' %}

{% block script %}

<script type='text/javascript'>

var vm = new Vue({
      delimiters: ['[[', ']]'],
      el: '#app',
      data: {
        window: 7,
        from: moment().subtract(14, "days").format("YYYY-MM-DD"),
        to:   moment().format("YYYY-MM-DD"),
        graph_type: "Time",
      },
      watch: {
        from:       function (newDate, oldDate) { this.debounce_update(); },
        to:         function (newDate, oldDate) { this.debounce_update(); },
        graph_type: function (newType, oldType) { this.debounce_update(); },
      },
      created: function () {
          this.debounce_update = _.debounce(this.update_graph, 750);
          this.update_graph();
      },
      methods: {
        update_graph: function () {
            if (this.graph_type === "Time") {
              load_time_graph("graph", "{% url 'summary_data' child.id %}", {"from": this.from, "to": this.to});
            } else if (this.graph_type === "Histogram") {
              load_histogram("graph", "{% url 'histogram_data' child.id %}", {"from": this.from, "to": this.to});
            }
        },
        move_window: function (direction) {
            this.from = moment(this.from).add(direction * this.window, "days").format("YYYY-MM-DD");
            this.to =   moment(this.to)  .add(direction * this.window, "days").format("YYYY-MM-DD");
        },
      },
});

</script>

{% endblock %}

{% block headline %}
Summary for {{ child.name }}
{% endblock %}

{% block content %}

<div id="app" class="container">
    <div class="dropdown mt-3">
      <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
        [[ graph_type ]]
      </button>
      <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
        <a class="dropdown-item" @click="graph_type = 'Time'" href="#">Time</a>
        <a class="dropdown-item" @click="graph_type = 'Histogram'" href="#">Histogram</a>
      </div>
    </div>

   <div id="graph"></div>

    <div class="row mb-2">
      <div class="col-sm"></div>
      <div class="col-xs-3">
        Select time range:
      </div>
      <div class="col-sm"></div>
    </div>

    <div class="row">
        <div class='col-sm'></div>
        <div class="col-xs-3 mx-2">
          From:
          <div class='input-group'>
              <input v-model="from" @changed="from = $event.target.value" type='date' class="form-control" />
          </div>
        </div>
        <div class="col-xs-3 mx-2">
          To:
          <div class='input-group'>
              <input v-model="to" @changed="to = $event.target.value" type='date' class="form-control" />
          </div>
        </div>
        <div class='col-sm'></div>
    </div>

    <div class="row">
        <div class='col-sm'></div>
        <div class='col-xs-2'>
          Shift time window (by days):
          <div class="input-group mb-5">
             <div @click="move_window(-1);"class="input-group-prepend1 page-link" aria-label="Previous">
               <span aria-hidden="true">&laquo;</span>
               <span class="sr-only">Previous</span>
             </div>
             <input v-model="window" type='number' size='2' min='1' max='365' class="form-control" />
             <div @click="move_window(1);" class="input-group-append page-link" aria-label="Next">
               <span aria-hidden="true">&raquo;</span>
               <span class="sr-only">Next</span>
             </div>
          </div>
        </div>
        <div class='col-sm'></div>
    </div>
</div>

{% endblock %}
